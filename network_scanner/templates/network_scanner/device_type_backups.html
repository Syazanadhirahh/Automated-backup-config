{% extends 'network_scanner/base.html' %}
{% load static %}

{% block content %}
<section class="space-y-6">
  <!-- Header -->
  <div class="flex items-center justify-between">
    <div>
      <h1 class="text-2xl font-bold text-slate-900">{{ device_type_display }} Backups</h1>
      <p class="text-slate-500">Manage backups for {{ device_type_display }} devices</p>
    </div>
    <a href="{% url 'network_scanner:backup_dashboard' %}" class="inline-flex items-center gap-2 text-yellow-500 hover:text-yellow-600">
      <i class="ti ti-arrow-left"></i> Back to Dashboard
    </a>
  </div>

  <!-- Statistics Cards -->
  <div class="grid grid-cols-1 md:grid-cols-4 gap-4">
    <div class="bg-white rounded-xl shadow p-6">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-2xl font-bold text-slate-900">{{ total_devices }}</div>
          <div class="text-sm text-slate-600">Total Devices</div>
        </div>
        <div class="p-3 bg-blue-100 rounded-lg">
          <i class="ti ti-device-desktop text-2xl text-blue-600"></i>
        </div>
      </div>
    </div>
    
    <div class="bg-white rounded-xl shadow p-6">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-2xl font-bold text-slate-900">{{ online_devices }}</div>
          <div class="text-sm text-slate-600">Online Devices</div>
        </div>
        <div class="p-3 bg-green-100 rounded-lg">
          <i class="ti ti-wifi text-2xl text-green-600"></i>
        </div>
      </div>
    </div>
    
    <div class="bg-white rounded-xl shadow p-6">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-2xl font-bold text-slate-900">{{ total_configs }}</div>
          <div class="text-sm text-slate-600">Total Backups</div>
        </div>
        <div class="p-3 bg-yellow-100 rounded-lg">
          <i class="ti ti-device-floppy text-2xl text-yellow-600"></i>
        </div>
      </div>
    </div>
    
    <div class="bg-white rounded-xl shadow p-6">
      <div class="flex items-center justify-between">
        <div>
          <div class="text-2xl font-bold text-slate-900">{{ recent_configs }}</div>
          <div class="text-sm text-slate-600">Recent (7 days)</div>
        </div>
        <div class="p-3 bg-purple-100 rounded-lg">
          <i class="ti ti-clock text-2xl text-purple-600"></i>
        </div>
      </div>
    </div>
  </div>

  <!-- Device Type Icon and Description -->
  <div class="bg-gradient-to-r from-yellow-400 to-yellow-300 rounded-xl p-6 text-black">
    <div class="flex items-center gap-4">
      {% if device_type == 'firewall' %}
        <i class="ti ti-shield text-4xl"></i>
      {% elif device_type == 'f5' %}
        <i class="ti ti-server text-4xl"></i>
      {% elif device_type == 'infoblox' %}
        <i class="ti ti-dns text-4xl"></i>
      {% elif device_type == 'switch' %}
        <i class="ti ti-router text-4xl"></i>
      {% elif device_type == 'router' %}
        <i class="ti ti-route text-4xl"></i>
      {% else %}
        <i class="ti ti-device-desktop text-4xl"></i>
      {% endif %}
      <div>
        <h2 class="text-xl font-bold">{{ device_type_display }}</h2>
        <p class="text-gray-800">
          {% if device_type == 'firewall' %}
            Checkpoint Firewall devices for network security and access control
          {% elif device_type == 'f5' %}
            F5 Load Balancer devices for traffic distribution and application delivery
          {% elif device_type == 'infoblox' %}
            Infoblox DNS/DHCP devices for network services and IP management
          {% elif device_type == 'switch' %}
            Network Switch devices for local network connectivity
          {% elif device_type == 'router' %}
            Router devices for network routing and connectivity
          {% else %}
            Other network devices and equipment
          {% endif %}
        </p>
      </div>
    </div>
  </div>

  <!-- Devices List -->
  <div class="bg-white rounded-xl shadow p-6">
    <div class="flex items-center justify-between mb-6">
      <h2 class="text-lg font-semibold text-slate-900">{{ device_type_display }} Devices</h2>
      <a href="{% url 'admin:network_scanner_device_add' %}?device_type={{ device_type }}" class="inline-flex items-center gap-2 px-4 py-2 bg-yellow-400 hover:bg-yellow-500 text-black font-medium rounded-lg transition">
        <i class="ti ti-plus"></i>
        Add Device
      </a>
    </div>
    
    {% if devices %}
      <div class="grid grid-cols-1 lg:grid-cols-2 gap-4">
        {% for device in devices %}
          <div class="border border-slate-200 rounded-lg p-4 hover:shadow-md transition">
            <div class="flex items-start justify-between">
              <div class="flex-1">
                <h3 class="font-semibold text-slate-900">{{ device.ip_address }}</h3>
                {% if device.hostname %}
                  <p class="text-sm text-slate-500">{{ device.hostname }}</p>
                {% endif %}
                {% if device.description %}
                  <p class="text-sm text-slate-600 mt-1">{{ device.description|truncatewords:10 }}</p>
                {% endif %}
              </div>
              <div class="flex items-center gap-2">
                {% if device.status == 'online' %}
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                    <i class="ti ti-circle-filled text-green-500 mr-1"></i>
                    Online
                  </span>
                {% else %}
                  <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-red-100 text-red-800">
                    <i class="ti ti-circle-filled text-red-500 mr-1"></i>
                    Offline
                  </span>
                {% endif %}
              </div>
            </div>
            
            <div class="mt-4 flex items-center justify-between">
              <div class="text-sm text-slate-500">
                {% if device.last_scanned_at %}
                  Last seen: {{ device.last_scanned_at|date:"M d, H:i" }}
                {% else %}
                  Never scanned
                {% endif %}
              </div>
              <div class="flex items-center gap-2">
                <a href="{% url 'network_scanner:device_config_detail' device.id %}" class="text-yellow-500 hover:text-yellow-600">
                  <i class="ti ti-eye"></i>
                </a>
                <form method="post" action="{% url 'network_scanner:backup_device_config' device.id %}" class="inline">
                  {% csrf_token %}
                  <button type="submit" class="text-yellow-500 hover:text-yellow-600" title="Backup Now">
                    <i class="ti ti-device-floppy"></i>
                  </button>
                </form>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    {% else %}
      <div class="text-center py-8 text-slate-500">
        <i class="ti ti-device-off text-4xl mb-2"></i>
        <p>No {{ device_type_display }} devices found</p>
        <p class="text-sm">Add devices through the admin interface</p>
      </div>
    {% endif %}
  </div>

  <!-- Recent Backups -->
  {% if network_configs %}
    <div class="bg-white rounded-xl shadow p-6">
      <div class="flex items-center justify-between mb-6">
        <h2 class="text-lg font-semibold text-slate-900">Recent Backups</h2>
        <a href="{% url 'admin:network_scanner_networkconfig_changelist' %}?device__device_type__exact={{ device_type }}" class="text-yellow-500 hover:text-yellow-600 text-sm">View All</a>
      </div>
      
      <div class="overflow-x-auto">
        <table class="min-w-full divide-y divide-slate-200">
          <thead class="bg-slate-50">
            <tr>
              <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Device</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Config Type</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Version</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Backup Date</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Status</th>
              <th class="px-6 py-3 text-left text-xs font-medium text-slate-500 uppercase tracking-wider">Actions</th>
            </tr>
          </thead>
          <tbody class="bg-white divide-y divide-slate-200">
            {% for config in network_configs|slice:":10" %}
              <tr class="hover:bg-slate-50">
                <td class="px-6 py-4 whitespace-nowrap">
                  <div class="text-sm font-medium text-slate-900">{{ config.device.ip_address }}</div>
                  {% if config.device.hostname %}
                    <div class="text-sm text-slate-500">{{ config.device.hostname }}</div>
                  {% endif %}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900">{{ config.config_type|title }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-900">{{ config.version }}</td>
                <td class="px-6 py-4 whitespace-nowrap text-sm text-slate-500">{{ config.backup_timestamp|date:"M d, Y H:i" }}</td>
                <td class="px-6 py-4 whitespace-nowrap">
                  {% if config.is_active %}
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-green-100 text-green-800">
                      Active
                    </span>
                  {% else %}
                    <span class="inline-flex items-center px-2 py-1 rounded-full text-xs font-medium bg-gray-100 text-gray-800">
                      Inactive
                    </span>
                  {% endif %}
                </td>
                <td class="px-6 py-4 whitespace-nowrap text-sm font-medium">
                  <a href="{% url 'admin:network_scanner_networkconfig_change' config.id %}" class="text-yellow-500 hover:text-yellow-600">View</a>
                </td>
              </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
    </div>
  {% endif %}
</section>
{% endblock %}
